<%= render partial: "projects/header", locals: {project: @project, subtitle: "Roadmap"} %>

<div id="roadmap_view" class="hide-completed"></div>

<% content_for :javascripts do %>
<script type="text/javascript">
  $(function() {
    var milestones = <%= raw Houston::Roadmaps::MilestonePresenter.new(@milestones).to_json %>;
    Roadmaps.milestones = new Roadmaps.Milestones(milestones, {parse: true});
    <% if can?(:manage, @project.milestones.build) %>
    new Roadmaps.EditProjectRoadmapView({
      el: $('#roadmap_view')[0],
      projectId: <%= @project.id %>,
      projectSlug: '<%= @project.slug %>',
      projectColor: '<%= @project.color %>',
      markers: <%=raw @markers.to_json %>,
      milestones: Roadmaps.milestones
    }).render();
    <% else %>
    new Roadmaps.ShowProjectRoadmapView({
      el: $('#roadmap_view')[0],
      projectId: <%= @project.id %>,
      markers: <%=raw @markers.to_json %>,
      milestones: Roadmaps.milestones,
      showWeekends: true
    }).render();
    <% end %>
  });
</script>
<% end %>
